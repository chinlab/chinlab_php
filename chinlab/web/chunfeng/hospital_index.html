<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>诺春风医疗系统</title>

    <!-- Bootstrap Core CSS -->
    <link href="resource/sbadmin/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="resource/sbadmin/bower_components/bootstrap/dist/css/font-awesome.min.css" rel="stylesheet">
    <link href="resource/sbadmin/bower_components/bootstrap/dist/css/newstyle.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="resource/sbadmin/bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="resource/sbadmin/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css"
          rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="resource/sbadmin/bower_components/datatables-responsive/css/dataTables.responsive.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="resource/sbadmin/dist/css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="resource/sbadmin/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet"
          type="text/css">
    <link href="resource/sbadmin/bower_components/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="resource/sbadmin/bower_components/layer/skin/layer.css"
          id="layui_layer_skinlayercss">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery -->
    <script src="resource/sbadmin/bower_components/jquery/dist/jquery-1.9.1.min.js"></script>
    <script src="resource/sbadmin/bower_components/jquery/dist/jquery.form.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="resource/sbadmin/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="resource/sbadmin/bower_components/metisMenu/dist/metisMenu.min.js"></script>
    <script src="js/multiselect.min.js"></script>
    <!-- DataTables JavaScript -->
    <script src="resource/sbadmin/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="resource/sbadmin/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="resource/sbadmin/dist/js/sb-admin-2.js"></script>
    <!--new-->
    <script src="resource/sbadmin/bower_components/layer/layer.js"></script>
    <script type="text/javascript" src="resource/sbadmin/js/fnReloadAjax.js"></script>
    <script src="resource/sbadmin/bower_components/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
    <script src="resource/sbadmin/bower_components/datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
    <script src="resource/sbadmin/bower_components/colResizable/colResizable-1.6.js"></script>
    <script src="js/common.js" type="text/javascript" charset="utf-8"></script>
</head>
<body marginwidth="0" marginheight="0">
<div class="mycommonfade" style="background-color:#000; opacity:0.3; filter:alpha(opacity=30);"></div>
<div class="col-lg-12">
    <div class="panel panel-default">
        <!-- /.panel-heading -->
        <div class="panel-body">
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" id="closesearchform" data-parent="#accordion"
                               href="#collapseOne">
                                筛选条件<span class="icon-angle-up"></span>
                                <button data-id=""
                                        class="add_item_index btn btn-info">添加医院
                                </button>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <form class="">
                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label for="hospital_name">医院名称</label>
                                        <input type="text" name="hospital_name" id="hospital_name" value=""
                                               class="form-control" placeholder="医院名称">
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label for="hospital_level">医院等级</label>
                                        <select id="hospital_level" name="hospital_level" class="form-control"
                                                data-rel="chosen">
                                            <option value="">全部</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label for="is_top">是否推荐</label>
                                        <select id="is_top" name="is_top" class="form-control" data-rel="chosen">
                                            <option value="">全部</option>
                                            <option value="1">否</option>
                                            <option value="2">是</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label for="is_vip">是否VIP</label>
                                        <select id="is_vip" name="is_top" class="form-control" data-rel="chosen">
                                            <option value="">全部</option>
                                            <option value="1">否</option>
                                            <option value="2">是</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label for="is_search">是否搜索可见</label>
                                        <select id="is_search" name="is_top" class="form-control" data-rel="chosen">
                                            <option value="">全部</option>
                                            <option value="1">否</option>
                                            <option value="2">是</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <label for="is_delete">是否前端显示</label>
                                        <select id="is_delete" name="is_top" class="form-control" data-rel="chosen">
                                            <option value="">全部</option>
                                            <option value="1">是</option>
                                            <option value="2">否</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-2">
                                    <div class="form-group">
                                        <div class="col-sm-1">
                                            <button id="searchbtn" type="button" class="btn btn-primary"
                                                    style="margin-top:25px;">确定
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dataTable_wrapper">
                <table class="table table-striped table-bordered table-hover" id="datatable">
                    <thead>
                    <tr>
                        <th>医院ID</th>
                        <th>医院名称</th>
                        <th>医院图片</th>
                        <th>医院等级</th>
                        <th>所属地区</th>
                        <th>科室数量</th>
                        <th>医生人数</th>
                        <th>是否推荐</th>
                        <th>VIP数字</th>
                        <th>是否搜索可见</th>
                        <th>是否前端可见</th>
                        <th>医院操作</th>
                        <th>科室操作</th>
                        <th>医生操作</th>
                    </tr>
                    </thead>
                </table>
            </div>
        </div>
        <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
</div>
<!--添加科室-->
<script type="text/html" id="add_section_item">
    <div class="container col-sm-12" style="margin-top: 20px">
        <form action="" method="post" enctype="multipart/form-data" id="form_section">
            <input type="hidden" name="hospital_id" value="" id="s_hospital_id">
            <input type="hidden" name="hospital_name" value="" id="s_hospital_name">
            <input type="hidden" name="hospital_sections_id" value="" id="s_hospital_sections_id">
            <input type="hidden" name="section_name" value="" id="s_section_name">
            <input type="hidden" name="section_parent_name" value="" id="s_section_parent_name">
            <input type="hidden" name="hospital_sections_name" value="" id="s_hospital_sections_name">
            <input type="hidden" name="hospital_sections_parent_name" value="" id="s_hospital_sections_parent_name">

            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室选择</label></div>
                <div class="col-sm-5">
                    <select id="h_sections_one" name="section_parent_id" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
                <div class="col-sm-5">
                    <select id="h_sections_two" name="section_id" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室介绍</label></div>
                <div class="col-sm-10"><textarea rows="3" name="hospital_sections_remark" class="form-control"
                                                 id="s_hospital_sections_remark"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室地位</label></div>
                <div class="col-sm-10"><textarea rows="3" type="text" name="hospital_sections_place"
                                                 class="form-control" id="s_hospital_sections_place"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室力量</label></div>
                <div class="col-sm-10"><textarea rows="3" type="text" name="hospital_sections_chief"
                                                 class="form-control" id="s_hospital_sections_chief"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室规模</label></div>
                <div class="col-sm-10"><textarea rows="3" type="text" name="hospital_sections_scale"
                                                 class="form-control" id="s_hospital_sections_scale"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室专长</label></div>
                <div class="col-sm-10"><textarea rows="3" type="text" name="hospital_sections_special"
                                                 class="form-control" id="s_hospital_sections_special"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室荣誉</label></div>
                <div class="col-sm-10"><textarea rows="3" type="text" name="hospital_sections_honor"
                                                 class="form-control" id="s_hospital_sections_honor"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>是否推荐</label></div>
                <div class="col-sm-10">
                    <select id="s_is_top" name="is_delete" class="form-control" data-rel="chosen">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label for="h_is_delete">是否前端显示</label></div>
                <div class="col-sm-10">
                    <select id="s_is_delete" name="is_delete" class="form-control" data-rel="chosen">
                        <option value="2">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <button type="button" class="btn btn-default" id="section_commit">提交</button>
        </form>
    </div>
</script>
<!--添加医生-->
<script type="text/html" id="add_doctor_item">
    <div class="container col-sm-12" style="margin-top: 20px">
        <form action="" method="post" enctype="multipart/form-data" id="form_doctor">
            <input type="hidden" name="hospital_id" value="" id="d_hospital_id">
            <input type="hidden" name="doctor_id" value="" id="d_doctor_id">
            <input type="hidden" name="section_select" value="" id="d_section_select">

            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label for="h_hospital_name">医生姓名</label></div>
                <div class="col-sm-10"><input type="text" class="form-control" id="d_doctor_name" name="doctor_name">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label for="d_doctor_image">医生图片</label></div>
                <div class="col-sm-10"><input type="file" class="form-control" id="d_doctor_image" name="fileName">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>医生职位</label></div>
                <div class="col-sm-10">
                    <select id="d_doctor_position" name="doctor_position" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>科室选择</label></div>
                <div class="col-sm-5">
                    <select name="from" id="optgroup" class="form-control" size="8" multiple="multiple">
                    </select>
                </div>
                <div class="col-sm-5">
                    <select name="to" id="optgroup_to" class="form-control" size="8" multiple="multiple">
                        <!--option value="1">C++</option-->
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>医生简介</label></div>
                <div class="col-sm-10"><textarea rows="4" name="doctor_des" class="form-control" id="d_doctor_des"></textarea>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>擅长领域</label></div>
                <div class="col-sm-10"><textarea rows="4" name="good_at" class="form-control" id="d_good_at"></textarea>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>荣誉</label></div>
                <div class="col-sm-10"><textarea rows="4" type="text" name="honor" class="form-control"
                                                 id="d_honor"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>执业经历</label></div>
                <div class="col-sm-10"><textarea rows="4" type="text" name="work_experience" class="form-control"
                                                 id="s_work_experience"></textarea></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label>是否推荐</label></div>
                <div class="col-sm-10">
                    <select id="d_is_top" name="is_top" class="form-control" data-rel="chosen">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-2"><label for="h_is_delete">是否前端显示</label></div>
                <div class="col-sm-10">
                    <select id="d_is_delete" name="is_delete" class="form-control" data-rel="chosen">
                        <option value="2">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <button type="button" class="btn btn-default" id="doctor_commit">提交</button>
        </form>
    </div>
</script>
<!--添加医院-->
<script type="text/html" id="add_hospital_item">
    <div class="container col-sm-12" style="margin-top: 20px">
        <form action="" method="post" enctype="multipart/form-data" id="form_hospital">
            <input type="hidden" name="hospital_id" value="" id="h_hospital_id">

            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_hospital_name">医院名称</label></div>
                <div class="col-sm-9"><input type="text" class="form-control" id="h_hospital_name" name="hospital_name">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_hospital_image">医院图片</label></div>
                <div class="col-sm-9"><input type="file" class="form-control" id="h_hospital_image" name="fileName">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_hospital_level">医院等级</label></div>
                <div class="col-sm-9">
                    <select id="h_hospital_level" name="hospital_level" class="form-control"
                            data-rel="chosen">
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_district_id">医院地区</label></div>
                <div class="col-sm-3">
                    <select id="h_district_id" name="district_id" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
                <div class="col-sm-3">
                    <select id="h_district_id_one" name="district_id_one" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
                <div class="col-sm-3">
                    <select id="h_district_id_two" name="district_id_two" class="form-control" data-rel="chosen">
                        <option value="0">请选择</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_sections_num">科室数目</label></div>
                <div class="col-sm-9"><input type="number" name="sections_num" class="form-control" id="h_sections_num">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_doctors_num">医生数量</label></div>
                <div class="col-sm-9"><input type="number" name="doctors_num" class="form-control" id="h_doctors_num">
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_is_vip">VIP数字(0为非vip医院)</label></div>
                <div class="col-sm-9"><input type="number" name="is_vip" class="form-control" id="h_is_vip"></div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_is_top">是否推荐</label></div>
                <div class="col-sm-9">
                    <select id="h_is_top" name="is_top" class="form-control" data-rel="chosen">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_is_delete">是否前端显示</label></div>
                <div class="col-sm-9">
                    <select id="h_is_delete" name="is_delete" class="form-control" data-rel="chosen">
                        <option value="2">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_is_search">是否搜索可见</label></div>
                <div class="col-sm-9">
                    <select id="h_is_search" name="is_search" class="form-control" data-rel="chosen">
                        <option value="0">否</option>
                        <option value="1">是</option>
                    </select>
                </div>
            </div>
            <div class="form-group col-sm-12">
                <div class="col-sm-3"><label for="h_hospital_des">医院简介</label></div>
                <div class="col-sm-9"><textarea class="form-control" rows="4" id="h_hospital_des"
                                                name="hospital_des"></textarea></div>
            </div>
            <button type="button" class="btn btn-default" id="hospital_commit">提交</button>
        </form>
    </div>
</script>

<script>
    $(document).ready(function () {
        $.ajaxSetup({
            async: false
        });
        var hospital_level = {};
        var section_info = {};
        //获取hospitallevel
        function getHospitalLevel() {

            $.post(local + "/hospital_gethospitallevel.php", {}, function (data) {
                hospital_level = data;
                var str = '<option value="0">全部</option>';
                $.each(data, function (k, v) {
                    str += '<option value="' + v.val + '">' + v.name + '</option>';
                });
                $("#hospital_level").html(str);
            }, "json");
        }

        getHospitalLevel();
        //table列表
        var dataTable = $('#datatable').DataTable({
            "processing": true,
            "serverSide": true,
            "searching": false,
            "ordering": false,
            "bLengthChange": false, //去掉每页显示多少条数据方法
            "iDisplayLength": 10,
            "stateSave": false,
            "ajax": {
                url: local + "/hospital_index.php", // json datasource
                type: "post",  // method  , by default get
                error: function () {  // error handling
                    $(".employee-grid-error").html("");
                    $("#employee-grid").append('<tbody class="employee-grid-error"><tr><th colspan="3">No data found in the server</th></tr></tbody>');
                    $("#employee-grid_processing").css("display", "none");
                },
                "data": function (d) {
                    //添加额外的参数传给服务器
                    d.name = $("#hospital_name").val();
                    d.is_vip = $("#is_vip").val();
                    d.is_top = $("#is_top").val();
                    d.is_search = $("#is_search").val();
                    d.is_delete = $("#is_delete").val();
                    d.hospital_level = $("#hospital_level").val();
                }
            },
            "columns": [
                {"data": "hospital_id"},
                {"data": "hospital_name"},
                {
                    "data": function (data) {
                        return '<img src="' + data.hospital_small_img + '" width="50"  height="50"/><div id="detail_' + data.hospital_id + '" style="display: none">' + data.hospital_name + '</div>';
                    }
                },
                {
                    "data": function (data) {
                        var item_parent_name = "";
                        $.each(hospital_level, function (k, v) {
                            if (v.val == data.hospital_level) {
                                item_parent_name = v.name;
                            }
                        });
                        return item_parent_name;
                    }
                },
                {"data": "district_address"},
                {"data": "sections_num"},
                {"data": "doctors_num"},
                {
                    "data": function (data) {
                        if (data.is_top == 1) {
                            return '是';
                        }
                        return '否';
                    }
                },
                {"data": "is_vip"},
                {
                    "data": function (data) {
                        if (data.is_search == 1) {
                            return '是';
                        }
                        return '否';
                    }
                },
                {
                    "data": function (data) {
                        if (data.is_delete == 1) {
                            return '是';
                        }
                        return '否';
                    }
                }
            ],
            "oLanguage": {//对表格国际化
                "sLengthMenu": "每页显示 _MENU_条",
                "sZeroRecords": "没有找到符合条件的数据",
                //  "sProcessing": "&lt;img src=’./loading.gif’ /&gt;",
                "sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
                "sInfoEmpty": "木有记录",
                "sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
                "sSearch": "搜索：",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                }
            },
            "columnDefs": [
                {
                    "targets": [11],
                    "data": function (data) {
                        return data.hospital_id;
                    },
                    "render": function (data, type, full) {
                        return '<a class="add_item_index btn btn-info" data-id="' + data + '" href="javascript:void(0)">修改医院</a>';
                    }
                },
                {
                    "targets": [12],
                    "data": function (data) {
                        return data.hospital_id;
                    },
                    "render": function (data, type, full) {
                        return '<a class="add_section_index btn btn-info" data-id="' + data + '" href="javascript:void(0)">添加科室</a>';
                    }
                },
                {
                    "targets": [13],
                    "data": function (data) {
                        return data.hospital_id;
                    },
                    "render": function (data, type, full) {
                        return '<a class="add_doctor_index btn btn-info" data-id="' + data + '" href="javascript:void(0)">添加医生</a>';
                    }
                }
            ]
        });
        //搜索item
        $("#searchbtn").click(function () {
            dataTable.draw();
        });
        //添加科室界面
        $(document).on('click', '.add_section_index', function () {
            content = $("#add_section_item").html();
            var hospital_id = $(this).attr("data-id");
            var hospital_name = $("#detail_" + hospital_id).html();
            var addlayer = layer.open({
                type: 1,
                title: "添加科室[医院名称：" + hospital_name + "]",
                skin: 'layui-layer-rim', //加上边框
                area: ['900px', '800px'], //宽高
                content: content
            });
            $("#s_hospital_id").val(hospital_id);
            $("#s_hospital_name").val(hospital_name);
            $.post(local + "/section_getsectionbackend.php", {"hospital_id": hospital_id}, function (data) {
                section_info = data;
                var str = '<option value="0">请选择</option>';
                $.each(data.one_section, function (k, v) {
                    str += '<option value="' + v.id + '">' + v.name + '</option>';
                });
                $("#h_sections_one").html(str);
            }, "json");

        });
        //选择科室
        $(document).on('change', '#h_sections_one', function () {
            var section_one_id = $(this).children('option:selected').val();
            $("#s_section_parent_name").val($(this).children('option:selected').text());
            $("#s_hospital_sections_parent_name").val($(this).children('option:selected').text());
            var str = '<option value="0">请选择</option>';
            $.each(section_info[section_one_id], function (k, v) {
                str += '<option value="' + v.id + '">' + v.name + '</option>';
            });
            $("#h_sections_two").html(str);
        });
        $(document).on('change', '#h_sections_two', function () {
            var section_two_name = $(this).children('option:selected').text();
            $("#s_section_name").val(section_two_name);
            $("#s_hospital_sections_name").val(section_two_name);
        });
        //添加科室
        $(document).on('click', '#section_commit', function () {
            console.log($("#h_sections_two").children('option:selected').val());
            if ($("#h_sections_two").children('option:selected').val() == 0) {
                layer.msg('请选择二级科室', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            var options = {
                type: "post",//请求方式：get或post
                url: local + "/hospitalsection_updateinsert.php",
                dataType: "json",//数据返回类型：xml、json、script
                success: function (data) {//表单提交成功回调函数
                    if (data.state == 0) {
                        layer.msg('提交成功', {icon: 1, closeBtn: 1, shadeClose: true});
                        setTimeout("layer.closeAll()", 2000);
                    } else {
                        layer.msg(data.message, {icon: 5, closeBtn: 1, shadeClose: true});
                    }
                },
                error: function (err) {
                    console.log(err);
                    layer.msg('提交表单异常' + err.msg, {icon: 1, closeBtn: 1, shadeClose: true});
                }
            };
            $("#form_section").ajaxSubmit(options);
        });
        //添加医生界面
        $(document).on('click', '.add_doctor_index', function () {
            var content = $("#add_doctor_item").html();
            var hospital_id = $(this).attr("data-id");
            var hospital_name = $("#detail_" + hospital_id).html();
            var addlayer = layer.open({
                type: 1,
                title: "添加医生[医院名称：" + hospital_name + "]",
                skin: 'layui-layer-rim', //加上边框
                area: ['900px', '800px'], //宽高
                content: content
            });
            $("#d_hospital_id").val(hospital_id);
            $.post(local + "/doctors_getlevel.php", {}, function (data) {
                var str = '<option value="0">请选择</option>';
                $.each(data, function (k, v) {
                    str += '<option value="' + v.val + '">' + v.name + '</option>';
                });
                $("#d_doctor_position").html(str);
            }, "json");

            $.post(local + "/hospitalsection_getinsertsection.php", {"hospital_id":hospital_id}, function (data) {
                var str = '';
                $.each(data, function (k, v) {
                    str += '<optgroup label="'+v.name+'">';
                    $.each(v.child, function(kk, vv) {
                        str += '<option value="'+ vv.id +'">'+vv.name+'</option>';
                    });
                    str += '</optgroup>';
                });
                $("#optgroup").html(str);
            }, "json");
            $("#optgroup").multiselect();
        });
        //添加医生
        $(document).on('click', '#doctor_commit', function () {
            if ($("#d_doctor_position").children('option:selected').val() == 0) {
                layer.msg('请选择医生职位', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            if ($("#d_doctor_name").val() == "") {
                layer.msg('请填写医生名称', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            var jsonArr = [];
            var index = 0;
            $('#optgroup_to option').each(function(k,v) {
                jsonArr[index] = $(this).val();
                index = index + 1;
            });
            $("#d_section_select").val(JSON.stringify(jsonArr));
            var options = {
                type: "post",//请求方式：get或post
                url: local + "/doctors_updateinsert.php",
                dataType: "json",//数据返回类型：xml、json、script
                success: function (data) {//表单提交成功回调函数
                    if (data.state == 0) {
                        layer.msg('提交成功', {icon: 1, closeBtn: 1, shadeClose: true});
                        setTimeout("layer.closeAll()", 2000);
                    } else {
                        layer.msg(data.message, {icon: 5, closeBtn: 1, shadeClose: true});
                    }
                },
                error: function (err) {
                    console.log(err);
                    layer.msg('提交表单异常' + err.msg, {icon: 1, closeBtn: 1, shadeClose: true});
                }
            };
            $("#form_doctor").ajaxSubmit(options);
        });
        //添加医院界面
        $(document).on('click', '.add_item_index', function () {
            content = $("#add_hospital_item").html();
            hospital_id = $(this).attr("data-id");
            var commit_title = "修改医院";
            if (hospital_id == "") {
                commit_title = "添加医院"
            }
            var addlayer = layer.open({
                type: 1,
                title: commit_title,
                skin: 'layui-layer-rim', //加上边框
                area: ['900px', '800px'], //宽高
                content: content
            });
            var str = '';
            $.each(hospital_level, function (k, v) {
                str += '<option value="' + v.val + '">' + v.name + '</option>';
            });
            $("#h_hospital_level").html(str);
            if (hospital_id == "") {
                $.post(local + "/hospital_getdistrict.php", {"id": "s0"}, function (data) {
                    var str = '<option value="0">请选择</option>';
                    $.each(data, function (k, v) {
                        str += '<option value="' + v.id + '">' + v.name + '</option>';
                    });
                    $("#h_district_id").html(str);
                }, "json");
            } else {
                $.post(local + "/hospital_getbyid.php", {"id": hospital_id}, function (data) {
                    if (data.state != "0") {
                        layer.msg('找不到该医院信息', {icon: 1, closeBtn: 1, shadeClose: true});
                        return "";
                    }
                    //1
                    var d_1 = '<option value="0">请选择</option>';
                    $.each(data.data.dis.s1.list, function (k, v) {
                        if (data.data.dis.s1.item == v.id) {
                            d_1 += '<option value="' + v.id + '" selected>' + v.name + '</option>';
                        } else {
                            d_1 += '<option value="' + v.id + '">' + v.name + '</option>';
                        }
                    });
                    //2
                    var d_2 = '<option value="0">请选择</option>';
                    $.each(data.data.dis.s2.list, function (k, v) {
                        if (data.data.dis.s2.item == v.id) {
                            d_2 += '<option value="' + v.id + '" selected>' + v.name + '</option>';
                        } else {
                            d_2 += '<option value="' + v.id + '">' + v.name + '</option>';
                        }
                    });
                    //3
                    var d_3 = '<option value="0">请选择</option>';
                    $.each(data.data.dis.s3.list, function (k, v) {
                        if (data.data.dis.s3.item == v.id) {
                            d_3 += '<option value="' + v.id + '" selected>' + v.name + '</option>';
                        } else {
                            d_3 += '<option value="' + v.id + '">' + v.name + '</option>';
                        }
                    });
                    $("#h_district_id").html(d_1);
                    $("#h_district_id_one").html(d_2);
                    $("#h_district_id_two").html(d_3);
                    $("#h_hospital_name").val(data.data.info.hospital_name);
                    $("#h_hospital_des").val(data.data.info.hospital_des);
                    $("#h_sections_num").val(data.data.info.sections_num);
                    $("#h_doctors_num").val(data.data.info.doctors_num);
                    $("#h_is_vip").val(data.data.info.is_vip);
                    $("#h_is_top").val(data.data.info.is_top);
                    $("#h_is_delete").val(data.data.info.is_delete);
                    $("#h_is_search").val(data.data.info.is_search);
                    $("#h_hospital_level").val(data.data.info.hospital_level);
                    $("#h_hospital_id").val(data.data.info.hospital_id);
                }, "json");
            }
        });
        //搜索二级地区
        $(document).on('change', '#h_district_id', function () {
            id = $(this).children('option:selected').val();
            $.post(local + "/hospital_getdistrict.php", {"id": id}, function (data) {
                var str = '<option value="0">请选择</option>';
                $.each(data, function (k, v) {
                    str += '<option value="' + v.id + '">' + v.name + '</option>';
                });
                $("#h_district_id_one").html(str);
            }, "json");
        });
        //搜索三级地区
        $(document).on('change', '#h_district_id_one', function () {
            id = $(this).children('option:selected').val();
            $.post(local + "/hospital_getdistrict.php", {"id": id}, function (data) {
                var str = '<option value="0">请选择</option>';
                $.each(data, function (k, v) {
                    str += '<option value="' + v.id + '">' + v.name + '</option>';
                });
                $("#h_district_id_two").html(str);
            }, "json");
        });
        //添加医院
        $(document).on('click', '#hospital_commit', function () {
            hospital_name = $("#h_hospital_name").val();
            if (hospital_name == "") {
                layer.msg('医院名称不能为空', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            hospital_desc = $("#h_hospital_des").val();
            if (hospital_desc == "") {
                layer.msg('医院描述不能为空', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            district_id = $("#h_district_id").val();
            if (district_id == "0") {
                layer.msg('请选择医院所在地区', {icon: 1, closeBtn: 1, shadeClose: true});
                return;
            }
            var options = {
                type: "post",//请求方式：get或post
                url: local + "/hospital_updateinsert.php",
                dataType: "json",//数据返回类型：xml、json、script
                success: function (data) {//表单提交成功回调函数
                    if (data.state == 0) {
                        dataTable.draw();
                        layer.msg('提交成功', {icon: 1, closeBtn: 1, shadeClose: true});
                        setTimeout("layer.closeAll()", 2000);
                    } else {
                        layer.msg(data.message, {icon: 5, closeBtn: 1, shadeClose: true});
                    }
                },
                error: function (err) {
                    console.log(err);
                    layer.msg('提交表单异常' + err.msg, {icon: 1, closeBtn: 1, shadeClose: true});
                }
            };
            $("#form_hospital").ajaxSubmit(options);
        });
    });
</script>
</body>
</html>