<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>诺春风医疗系统</title>

        <!-- Bootstrap Core CSS -->
        <link href="resource/sbadmin/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="resource/sbadmin/bower_components/bootstrap/dist/css/font-awesome.min.css" rel="stylesheet">
        <link href="resource/sbadmin/bower_components/bootstrap/dist/css/newstyle.css" rel="stylesheet">

        <!-- MetisMenu CSS -->
        <link href="resource/sbadmin/bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

        <!-- DataTables CSS -->
        <link href="resource/sbadmin/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet">

        <!-- DataTables Responsive CSS -->
        <link href="resource/sbadmin/bower_components/datatables-responsive/css/dataTables.responsive.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="resource/sbadmin/dist/css/sb-admin-2.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="resource/sbadmin/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href="resource/sbadmin/bower_components/datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet" type="text/css">
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- jQuery -->
        <script src="resource/sbadmin/bower_components/jquery/dist/jquery.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="resource/sbadmin/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src="resource/sbadmin/bower_components/metisMenu/dist/metisMenu.min.js"></script>

        <!-- DataTables JavaScript -->
        <script src="resource/sbadmin/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
        <script src="resource/sbadmin/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="resource/sbadmin/dist/js/sb-admin-2.js"></script>
        <!--new-->
        <script src="resource/sbadmin/bower_components/layer/layer.js"></script>
        <script type="text/javascript" src="resource/sbadmin/js/fnReloadAjax.js"></script>
        <script src="resource/sbadmin/bower_components/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
        <script src="resource/sbadmin/bower_components/datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
        <script src="resource/sbadmin/bower_components/colResizable/colResizable-1.6.js"></script>
        
         <script src="resource/sbadmin/bower_components/Bootstrap-3-Typeahead-master/bootstrap3-typeahead.js"></script>
         <script src="js/common.js" type="text/javascript" charset="utf-8"></script>
        <style>
            .breadcrumb{
                padding:0px;
                margin-bottom: 0px;
            }

            #datatable td,#datatable th{
                overflow-x:hidden;
                max-width: 60px;
                white-space:nowrap;
                overflow:hidden;
            }
        </style>
        <script>
            $(function() {
                var tdtipindex = "";
                $(document).on("mouseover", "#datatable td,#datatable th", function() {
                    var tdcontent = $(this).text();
                    tdtipindex = layer.tips(tdcontent, $(this), {
                        tips: [1, '#333333'],
                        time: 0
                    });
                }).on("mouseout", "#datatable td,#datatable th", function() {
                    layer.close(tdtipindex);
                });
            });
        </script>
    </head>
    <body>
        <div class="mycommonfade" style="background-color:#000; opacity:0.3; filter:alpha(opacity=30);"></div><div class="col-lg-12">
    <div class="panel panel-default">
        <!-- /.panel-heading -->
        <div class="panel-body">
            <div class="panel-group" id="accordion">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4 class="panel-title">
                            <a data-toggle="collapse" id="closesearchform" data-parent="#accordion"
                               href="#collapseOne">
                                筛选条件
                                <span class="icon-angle-up">
                                </span>
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in">
                        <div class="panel-body">
                            <form class="">
                                <div class="clearfix">
                                </div>
                                <div class="col-sm-3">
                                    <div class="form-group">
                                        <label for="version_name">版本名称</label>
                                        <input type="text" class="form-control" id="version_name" placeholder="版本名称">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-1">
                                        <button id="searchbtn" type="button" class="btn btn-primary" style="margin-top:25px;">
                                            确定
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dataTable_wrapper">
                <table class="table table-striped table-bordered table-bversioned table-hover" id="datatable">
                    <thead>
                        <tr>
                            <th>
                                版本名称
                            </th>
                            <th>
                                版本简介
                            </th>
                            <th>
                                设备
                            </th>
                            <th>
                                发布版本时间
                            </th>
                            <th>
                                操作
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <!-- /.panel-body -->
    </div>
    <!-- /.panel -->
</div>
<script>
    var table;
    $(document).ready(function () {
        $('#collapseOne').on('show.bs.collapse',
                function () {
                    $("#closesearchform").html('筛选条件<span class="icon-angle-up"></span>');
                });
        $('#collapseOne').on('hide.bs.collapse',
                function () {
                    $("#closesearchform").html('筛选条件<span class="icon-angle-down"></span>');
                });
        $('#version_date_end').datetimepicker({
            language: 'zh-CN',
            format: "yyyy-mm-dd"
        }).on('changeDate', function (ev) {
        });

         table = $("#datatable").dataTable({
            "processing": true,
            "serverSide": false,
            "searching": false,
            "ordering": false,
            "versioning": false,
            "bLengthChange": false,
            //去掉每页显示多少条数据方法
            "iDisplayLength": 5,
            "stateSave": false,
            "oLanguage": {//对表格国际化
                "sLengthMenu": "每页显示 _MENU_条",
                "sZeroRecords": "没有找到符合条件的数据",
                //  "sProcessing": "&lt;img src=’./loading.gif’ /&gt;",
                "sInfo": "当前第 _START_ - _END_ 条　共计 _TOTAL_ 条",
                "sInfoEmpty": "木有记录",
                "sInfoFiltered": "(从 _MAX_ 条记录中过滤)",
                "sSearch": "搜索：",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                }
            },
            "columnDefs": [{
                    "searchable": true,
                    "targets": 1
                }],
            "ajax": {
                "url": local+"/version_indexJson.php",
                "dataSrc": function(data){
              		var data = data.data.data
              		return data
              	},
                "data": function (d) {
                    //添加额外的参数传给服务器
                    d.version_name = $("#version_name").val();
                }
            },
            "columns": [{
                    "data": "version_name",
                    "bSortable": false
                },
                {
                    "data": "version_design"
                },
                {
                    "data": "version_device"
                },
                {
                    "data": "version_time"
                }
            ],
            "columnDefs": [
                {
                    "targets": [4],
                    "data": "version_id",
                    "render": function (data, type, full) {
                        return '<a class="edittrinfo" id="' + data + '" trid="' + data + '" href="javascript:void(0)">查看/编辑</a>&nbsp;&nbsp;<a class="delrecord" id="' + data + 'del" trid="' + data + '" href="javascript:void(0)">删除</a>';
                    }
                }]
        });

        $("#searchbtn").click(function () {
            table.fnReloadAjax();
        });

    });


    $(document).on("click", ".edittrinfo",
            function () {
                var trid = $(this).attr("trid");
                $(document.body).css({
                    "overflow-x": "hidden",
                    "overflow-y": "hidden"
                });
                powidth = $(window).width() - 50;
                poheight = $(window).height() - 50;
                layerindex = layer.open({
                    type: 2,
                    title: "版本修改",
                    fix: false,
                    shadeClose: true,
                    maxmin: true,
                    area: [powidth + 'px', poheight + 'px'],
                    content: "version_returnuserinfo.html?id=" + trid,
                    end: function () {
                        reflashrecord(trid);
                        $(document.body).css({
                            "overflow-x": "auto",
                            "overflow-y": "auto"
                        });
                    }
                });
            });


    $(document).on("click", ".delrecord", function () {
        $trid = $(this).attr("trid");
        layer.confirm('确定要删除？', {
            btn: ['确定', '取消'] //按钮
        }, function ($index) {
            layer.close($index);
            var loadingindex = layer.load(1, {
                shade: [0.5, '#ddd'] //0.1透明度的白色背景
            });
            $.post(local+"/version_indexJson.php", {"id": $trid}, function (data) {
                layer.close(loadingindex);
                if (data.code == 0) {
                    layer.msg('删除成功', {icon: 1, closeBtn: 1, shadeClose: true});
                    table.fnReloadAjax();
                } else {
                    layer.msg(data.message, {icon: 5, closeBtn: 1, shadeClose: true});
                }
            }, "json")
        });
    });

    function reflashrecord(id) {
        $.post(local+"/version_indexJson.php", {
            "id": id
        },
                function (result) {
                    var data = result.data[0];
                    var $tds = $("#" + id).parents("tr").find("td");

                    $tds.eq(0).text(data.version_name);
                    $tds.eq(1).text(data.version_design);
                    $tds.eq(2).text(data.version_device);
                    $tds.eq(3).text(data.version_time);
                    return;
                },
                'json');
    }
</script>
</body>

</html>